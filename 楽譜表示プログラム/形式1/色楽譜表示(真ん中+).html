<!--知能情報処理研修室2018~2023-->
<!DOCTYPE html>
<html lang="ja">

<head>
 	<meta charset="UTF-8">
 	<title>色楽譜表示真ん中+</title>
	<link rel="stylesheet" href="gakuhu_color.css" type="text/css">
</head>

<body>
  	<form name="myform">
		<input name="myfile" type="file" />
		<input type="button" name="window" value="新しいウィンドウで開く" onclick="WindowOpen()"><br>
		<textarea name="output" cols="80" rows="10"></textarea>
 	
		<!-- 移調に関するボタン -->
		<select id=key  name="key" size="5" style="width: 100px">

			<option value="-12">  -12</option>
			<option value="-11">  -11</option>
			<option value="-10">  -10</option>
			<option value="-9">  -9</option>
			<option value="-8">  -8</option>
			<option value="-7">  -7</option>
			<option value="-6">  -6</option>
			<option value="-5">  -5</option>
			<option value="-4">  -4</option>
			<option value="-3">  -3</option>
			<option value="-2">  -2</option>
			<option value="-1">  -1</option>
			<option value="0" selected>0</option>
			<option value="1">  +1</option>
			<option value="2">  +2</option>
			<option value="3">  +3</option>
			<option value="4">  +4</option>
			<option value="5">  +5</option>
			<option value="6">  +6</option>
			<option value="7">  +7</option>
			<option value="8">  +8</option>
			<option value="9">  +9</option>
			<option value="10">  +10</option>
			<option value="11">  +11</option>
			<option value="12">  +12</option>

		</select>


		<select id=chogou  name="key" size="2" style="width: 100px">

			<option value="0" selected>#</option>
			<option value="1">♭</option>

		</select>

		<select id=chogou_re  name="key" size="2" style="width: 100px">

			<option value="0" selected>調号あり</option>
			<option value="1">調号なし</option>

		</select>
	
	</form>

	<div id="textbox">
    </div>
	<div id="box1">
	</div>

	<script>
		var form = document.forms.myform;
		var m;
    
		//midi number
		var key_num;
		var chou_ex;

		form.addEventListener('change', function() {
      		var result = form.myfile.files[0];
			var reader = new FileReader();
			reader.readAsText( result );

			key_num=Number(document.getElementById("key").value);
		//	console.log(key_num); //キーが選択されたものと同じか確認するため
		//	console.log(typeof(key_num));

			//シャープがフラットの選択(#→0  ♭→1)
			chou=Number(document.getElementById("chogou").value);

			//調号あり（0）調合なし(1)
			chou_ex=Number(document.getElementById("chogou_re").value);


			reader.addEventListener( 'load', function() {

				form.output.textContent = reader.result;				//独自形式楽譜データの読み込み

				var gyou = reader.result.split('\n');					//行で分割
				
				k = /[\[\]]/;

				var title = gyou[0].split(k);
                var composer = gyou[1].split(k);
                var lyricist = gyou[2].split(k);
                var copyright = gyou[3].split(k);
                var key = gyou[4].split(k);
                var tempo = gyou[5].split(k);
				var minimum = gyou[6].split(k);				
				var beat = gyou[7].split(k);
				var measure = gyou[8].split(k);              //楽譜情報ファイル最初10行のデータの格納

				var beattype = beat[1].split('\/');					//alterは分母と分子で分割

				m = parseInt(measure[1],10);

				var i;
                
                //ここから下はタイトル等の表示
                
                document.getElementById('textbox').innerHTML = '    <div id="titlebox"></div><div id="composerbox"></div><div id="lyricistbox"></div><div id="copyrightbox"></div><div id="tempobox"></div>';
                document.getElementById('titlebox').innerHTML = title[1];
                document.getElementById('composerbox').innerHTML = "作曲者:"+composer[1];
                document.getElementById('lyricistbox').innerHTML = "作詞者:"+lyricist[1];
                document.getElementById('copyrightbox').innerHTML = "コピーライト："+copyright[1];
                document.getElementById('tempobox').innerHTML = "tempo="+tempo[1];

                
				//ここから下は楽譜テンプレート。「score4m3b4」は最小４分音符、拍子3/4。

				var score4m4b4 = '<table class = "table4m4b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"colspan="2"></td><td class = "c1-2"colspan="2"></td><td class = "c1-3"colspan="2"></td><td class = "c1-4"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"colspan="2"></td><td class = "c2-2"colspan="2"></td><td class = "c2-3"colspan="2"></td><td class = "c2-4"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"colspan="2"></td><td class = "c3-2"colspan="2"></td><td class = "c3-3"colspan="2"></td><td class = "c3-4"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"colspan="2"></td><td class = "c5-2"colspan="2"></td><td class = "c5-3"colspan="2"></td><td class = "c5-4"colspan="2"></td>'+
						'</tr>'+
						'</table><br>';

				var score4m3b4 ='<table class = "table4m3b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"colspan="2"></td><td class = "c1-2"colspan="2"></td><td class = "c1-3"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"colspan="2"></td><td class = "c2-2"colspan="2"></td><td class = "c2-3"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"colspan="2"></td><td class = "c3-2"colspan="2"></td><td class = "c3-3"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"colspan="2"></td><td class = "c5-2"colspan="2"></td><td class = "c5-3"colspan="2"></td>'+
						'</tr>'+
						'</table><br>';

				var score4m2b4 = '<table class = "table4m2b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"colspan="2"></td><td class = "c1-2"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"colspan="2"></td><td class = "c2-2"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"colspan="2"></td><td class = "c3-2"colspan="2"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"colspan="2"></td><td class = "c5-2"colspan="2"></td>'+
						'</tr>'+
						'</table><br>';

				var score8m4b4 = '<table class = "table8m4b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td><td class = "c1-7"></td><td class = "c1-8"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td><td class = "c2-7"></td><td class = "c2-8"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td><td class = "c3-7"></td><td class = "c3-8"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td><td class = "c5-7"></td><td class = "c5-8"></td>'+
						'</tr>'+
						'</table><br>';

				var score8m3b4 ='<table class = "table8m3b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td>'+
						'</tr>'+
						'</table><br>';

				var score8m2b4 ='<table class = "table8m2b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td>'+
						'</tr>'+
						'</table><br>';

				var score16m4b4 ='<table class = "table16m4b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td><td class = "c1-7"></td><td class = "c1-8"></td><td class = "c1-9"></td><td class = "c1-10"></td><td class = "c1-11"></td><td class = "c1-12"></td><td class = "c1-13"></td><td class = "c1-14"></td><td class = "c1-15"></td><td class = "c1-16"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td><td class = "c2-7"></td><td class = "c2-8"></td><td class = "c2-9"></td><td class = "c2-10"></td><td class = "c2-11"></td><td class = "c2-12"></td><td class = "c2-13"></td><td class = "c2-14"></td><td class = "c2-15"></td><td class = "c2-16"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td><td class = "c3-7"></td><td class = "c3-8"></td><td class = "c3-9"></td><td class = "c3-10"></td><td class = "c3-11"></td><td class = "c3-12"></td><td class = "c3-13"></td><td class = "c3-14"></td><td class = "c3-15"></td><td class = "c3-16"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td><td class = "c4-9"></td><td class = "c4-10"></td><td class = "c4-11"></td><td class = "c4-12"></td><td class = "c4-13"></td><td class = "c4-14"></td><td class = "c4-15"></td><td class = "c4-16"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td><td class = "c5-7"></td><td class = "c5-8"></td><td class = "c5-9"></td><td class = "c5-10"></td><td class = "c5-11"></td><td class = "c5-12"></td><td class = "c5-13"></td><td class = "c5-14"></td><td class = "c5-15"></td><td class = "c5-16"></td>'+
						'</tr>'+
						'</table><br>';

				var score16m3b4 ='<table class = "table16m3b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td><td class = "c1-7"></td><td class = "c1-8"></td><td class = "c1-9"></td><td class = "c1-10"></td><td class = "c1-11"></td><td class = "c1-12"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td><td class = "c2-7"></td><td class = "c2-8"></td><td class = "c2-9"></td><td class = "c2-10"></td><td class = "c2-11"></td><td class = "c2-12"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td><td class = "c3-7"></td><td class = "c3-8"></td><td class = "c3-9"></td><td class = "c3-10"></td><td class = "c3-11"></td><td class = "c3-12"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td><td class = "c4-9"></td><td class = "c4-10"></td><td class = "c4-11"></td><td class = "c4-12"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td><td class = "c5-7"></td><td class = "c5-8"></td><td class = "c5-9"></td><td class = "c5-10"></td><td class = "c5-11"></td><td class = "c5-12"></td>'+
						'</tr>'+
						'</table><br>';

				var score16m2b4 ='<table class = "table16m2b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td><td class = "c1-7"></td><td class = "c1-8"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td><td class = "c2-7"></td><td class = "c2-8"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td><td class = "c3-7"></td><td class = "c3-8"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td><td class = "c5-7"></td><td class = "c5-8"></td>'+
						'</tr>'+
						'</table><br>';
				var score8m6b8 ='<table class = "table8m3b4">'+
						'<tr class ="c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td>'+
						'</tr>'+
						'<tr class ="c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td>'+
						'</tr>'+
						'<tr class ="c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td>'+
						'</tr>'+
						'<tr class ="c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td>'+
						'</tr>'+
						'<tr class ="c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td>'+
						'</tr>'+
						'</table><br>';

				var score16m6b8 ='<table class = "table16m3b4">'+
						'<tr class = "c1">'+
							'<td class = "c1-1"></td><td class = "c1-2"></td><td class = "c1-3"></td><td class = "c1-4"></td><td class = "c1-5"></td><td class = "c1-6"></td><td class = "c1-7"></td><td class = "c1-8"></td><td class = "c1-9"></td><td class = "c1-10"></td><td class = "c1-11"></td><td class = "c1-12"></td>'+
						'</tr>'+
						'<tr class = "c2">'+
							'<td class = "c2-1"></td><td class = "c2-2"></td><td class = "c2-3"></td><td class = "c2-4"></td><td class = "c2-5"></td><td class = "c2-6"></td><td class = "c2-7"></td><td class = "c2-8"></td><td class = "c2-9"></td><td class = "c2-10"></td><td class = "c2-11"></td><td class = "c2-12"></td>'+
						'</tr>'+
						'<tr class = "c3">'+
							'<td class = "c3-1"></td><td class = "c3-2"></td><td class = "c3-3"></td><td class = "c3-4"></td><td class = "c3-5"></td><td class = "c3-6"></td><td class = "c3-7"></td><td class = "c3-8"></td><td class = "c3-9"></td><td class = "c3-10"></td><td class = "c3-11"></td><td class = "c3-12"></td>'+
						'</tr>'+
						'<tr class = "c4">'+
							'<td class = "c4-1"></td><td class = "c4-2"></td><td class = "c4-3"></td><td class = "c4-4"></td><td class = "c4-5"></td><td class = "c4-6"></td><td class = "c4-7"></td><td class = "c4-8"></td><td class = "c4-9"></td><td class = "c4-10"></td><td class = "c4-11"></td><td class = "c4-12"></td>'+
						'</tr>'+
						'<tr class = "c5">'+
							'<td class = "c5-1"></td><td class = "c5-2"></td><td class = "c5-3"></td><td class = "c5-4"></td><td class = "c5-5"></td><td class = "c5-6"></td><td class = "c5-7"></td><td class = "c5-8"></td><td class = "c5-9"></td><td class = "c5-10"></td><td class = "c5-11"></td><td class = "c5-12"></td>'+
						'</tr>'+
						'<tr class = "c6">'+
							'<td class = "c6-1"></td><td class = "c6-2"></td><td class = "c6-3"></td><td class = "c6-4"></td><td class = "c6-5"></td><td class = "c6-6"></td><td class = "c6-7"></td><td class = "c6-8"></td><td class = "c6-9"></td><td class = "c6-10"></td><td class = "c6-11"></td><td class = "c6-12"></td>'+
						'</tr>'+
						'</table><br>';

				
				//ここから下は楽譜テンプレートのコピー。4/4は2小節、3/4は3小節、2/4は4小節で改行。

				var scorebox = document.getElementById("box1");
				var dan = 0;

				if(minimum[1]==4 && beattype[0]==4 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var mmeasure = parseInt(measure[1],10)+parseInt(measure[1],10)%2;	//空の小節数も合わせた全体の小節数の計算
					for(i=0; i<mmeasure; i++){
						if((i%2)==0){
								if(i>=parseInt(measure[1],10)){		//空の小節
									scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score4m4b4+'</div>');
								}
								else{		//通常の小節
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score4m4b4+'</div>');
								}
						}
						if((i%2)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score4m4b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score4m4b4+'</div>');
								}
						}
					}
					dan = 2;
				}

				if(minimum[1]==4 && beattype[0]==3 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var mmeasure = parseInt(measure[1],10)+(3-parseInt(measure[1],10)%3);
					if(parseInt(measure[1],10)%3==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%3)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score4m3b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score4m3b4+'</div>');
								}
						}
						if((i%3)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score4m3b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score4m3b4+'</div>');
								}
						}
						if((i%3)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score4m3b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score4m3b4+'</div>');
								}
						}
					}
					dan = 3;
				}

				if(minimum[1]==4 && beattype[0]==2 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td><td id="box5"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var scorebox5 = document.getElementById("box5");
					var mmeasure = parseInt(measure[1],10)+(4-parseInt(measure[1],10)%4);
					if(parseInt(measure[1],10)%4==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%4)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score4m2b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score4m2b4+'</div>');
								}
						}
						if((i%4)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score4m2b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score4m2b4+'</div>');
								}
						}
						if((i%4)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score4m2b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score4m2b4+'</div>');
								}
						}
						if((i%4)==3){
								if(i>=parseInt(measure[1],10)){
									scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score4m2b4+'</div>');
								}
								else{
        								scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score4m2b4+'</div>');
								}
						}
					}
					dan = 4;
				}

				if(minimum[1]==8 && beattype[0]==4 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var mmeasure = parseInt(measure[1],10)+parseInt(measure[1],10)%2;
					for(i=0; i<mmeasure; i++){
						if((i%2)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score8m4b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score8m4b4+'</div>');
								}
						}
						if((i%2)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score8m4b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score8m4b4+'</div>');
								}
						}
					}
					dan = 2;
				}

				if(minimum[1]==8 && beattype[0]==3 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var mmeasure = parseInt(measure[1],10)+(3-parseInt(measure[1],10)%3);
					if(parseInt(measure[1],10)%3==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%3)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
						if((i%3)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
						if((i%3)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
					}
					dan = 3;
				}

				if(minimum[1]==8 && beattype[0]==2 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td><td id="box5"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var scorebox5 = document.getElementById("box5");
					var mmeasure = parseInt(measure[1],10)+(4-parseInt(measure[1],10)%4);
					if(parseInt(measure[1],10)%4==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%4)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score8m2b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score8m2b4+'</div>');
								}
						}
						if((i%4)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score8m2b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score8m2b4+'</div>');
								}
						}
						if((i%4)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score8m2b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score8m2b4+'</div>');
								}
						}
						if((i%4)==3){
								if(i>=parseInt(measure[1],10)){
									scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score8m2b4+'</div>');
								}
								else{
        								scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score8m2b4+'</div>');
								}
						}
					}
					dan = 4;
				}

				if(minimum[1]==16 && beattype[0]==4 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var mmeasure = parseInt(measure[1],10)+parseInt(measure[1],10)%2;
					for(i=0; i<mmeasure; i++){
						if((i%2)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score16m4b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score16m4b4+'</div>');
								}
						}
						if((i%2)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>　'+score16m4b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mm'+i+'>第'+(i+1)+'小節'+score16m4b4+'</div>');
								}
						}
					}
					dan = 2;
				}

				if(minimum[1]==16 && beattype[0]==3 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var mmeasure = parseInt(measure[1],10)+(3-parseInt(measure[1],10)%3);
					if(parseInt(measure[1],10)%3==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%3)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
						if((i%3)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
						if((i%3)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
					}
					dan = 3;
			
				}

				if(minimum[1]==16 && beattype[0]==2 && beattype[1]==4){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td><td id="box5"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var scorebox5 = document.getElementById("box5");
					var mmeasure = parseInt(measure[1],10)+(4-parseInt(measure[1],10)%4);
					if(parseInt(measure[1],10)%4==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%4)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score16m2b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score16m2b4+'</div>');
								}
						}
						if((i%4)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score16m2b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score16m2b4+'</div>');
								}
						}
						if((i%4)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score16m2b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score16m2b4+'</div>');
								}
						}
						if((i%4)==3){
								if(i>=parseInt(measure[1],10)){
									scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score16m2b4+'</div>');
								}
								else{
        								scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score16m2b4+'</div>');
								}
						}
					}
					dan = 4;
				}

				if(minimum[1]==8 && beattype[0]==6 && beattype[1]==8){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var mmeasure = parseInt(measure[1],10)+(3-parseInt(measure[1],10)%3);
					if(parseInt(measure[1],10)%3==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%3)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
						if((i%3)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
						if((i%3)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score8m3b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score8m3b4+'</div>');
								}
						}
					}
					dan = 3;
				}
				if(minimum[1]==16 && beattype[0]==6 && beattype[1]==8){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var mmeasure = parseInt(measure[1],10)+(3-parseInt(measure[1],10)%3);
					if(parseInt(measure[1],10)%3==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%3)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
						if((i%3)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
						if((i%3)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>　'+score16m3b4+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmm'+i+'>第'+(i+1)+'小節'+score16m3b4+'</div>');
								}
						}
					}
					dan = 3;
				}

				//64はでて来ないのでは・・・？
				if(minimum[1]==64 && beattype[0]==6 && beattype[1]==8){
					scorebox.innerHTML='	<table><tr><td id="box2"></td><td id="box3"></td><td id="box4"></td><td id="box5"></td></tr></table>';
					var scorebox2 = document.getElementById("box2");
					var scorebox3 = document.getElementById("box3");
					var scorebox4 = document.getElementById("box4");
					var scorebox5 = document.getElementById("box5");
					var mmeasure = parseInt(measure[1],10)+(4-parseInt(measure[1],10)%4);
					if(parseInt(measure[1],10)%4==0){
						mmeasure=parseInt(measure[1],10);
					}
					for(i=0; i<mmeasure; i++){
						if((i%4)==0){
								if(i>=parseInt(measure[1],10)){
									scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score64m6b8+'</div>');
								}
								else{
        								scorebox2.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score64m6b8+'</div>');
								}
						}
						if((i%4)==1){
								if(i>=parseInt(measure[1],10)){
									scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score64m6b8+'</div>');
								}
								else{
        								scorebox3.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score64m6b8+'</div>');
								}
						}
						if((i%4)==2){
								if(i>=parseInt(measure[1],10)){
									scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score64m6b8+'</div>');
								}
								else{
        								scorebox4.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score64m6b8+'</div>');
								}
						}
						if((i%4)==3){
								if(i>=parseInt(measure[1],10)){
									scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>　'+score64m6b8+'</div>');
								}
								else{
        								scorebox5.insertAdjacentHTML('beforeend','<div id=mmmm'+i+'>第'+(i+1)+'小節'+score64m6b8+'</div>');
								}
						}
					}
					dan = 4;
				}


				var note = new Array;

				for(var i=10;i<gyou.length;i++){
					note[i] =gyou[i].split('\t');		//楽譜情報ファイルの5行目以降をタブ(\t)で分割
				}

				//ここから下は色の挿入。
				
				var j=0;	//小節番号
				var jsub=0;	//jの制御
				var ka=1;	//現在のセル
				var kb=1;	//同じ色が続くセルの末端のセルの番号
				var midinum=[]; //配列
				var color='' //色情報
		
				for(var i=10;i<gyou.length;i++){

					if(note[i][0]=='-'){		//小節の添え字の制御、現在のセルの初期化
						jsub++;
						if(dan==2){
							if((jsub%2)==0){
								j=jsub/2;
							}
							if((jsub%2)==1){
								j=Math.floor(mmeasure/2)+Math.floor(jsub/2);
							}
						}
						if(dan==3){
							if((jsub%3)==0){
								j=jsub/3;
							}
							if((jsub%3)==1){
								j=Math.floor(mmeasure/3)+Math.floor(jsub/3);
							}
							if((jsub%3)==2){
								j=Math.floor(mmeasure/3)*2+Math.floor(jsub/3);
							}
						}
						if(dan==4){
							if((jsub%4)==0){
								j=jsub/4;
							}
							if((jsub%4)==1){
								j=Math.floor(mmeasure/4)+Math.floor(jsub/4);
							}
							if((jsub%4)==2){
								j=Math.floor(mmeasure/4)*2+Math.floor(jsub/4);
							}
							if((jsub%4)==3){
								j=Math.floor(mmeasure/4)*3+Math.floor(jsub/4);
							}
						}
						kb=1;
						ka=1;
					}

					//セルの結合　最小音価が16のとき
					if((note[i][2]=='8'||note[i][2]=='4'||note[i][2]=='2'||note[i][2]=='8.'||note[i][2]=='4.'||note[i][2]=='2.') && minimum[1]=='16'){	
						var c1 = document.getElementsByClassName("c1-"+ka);
						var c2 = document.getElementsByClassName("c2-"+ka);
						var c3 = document.getElementsByClassName("c3-"+ka);
						var c4 = document.getElementsByClassName("c4-"+ka);
						var c5 = document.getElementsByClassName("c5-"+ka);


						c1[j].setAttribute('colspan','2');
						c2[j].setAttribute('colspan','2');
						c3[j].setAttribute('colspan','2');
						c4[j].setAttribute('colspan','2');
						c5[j].setAttribute('colspan','2');


						var cc1 = document.getElementsByClassName("c1-"+(ka+1));
						var cc2 = document.getElementsByClassName("c2-"+(ka+1));
						var cc3 = document.getElementsByClassName("c3-"+(ka+1));
						var cc4 = document.getElementsByClassName("c4-"+(ka+1));
						var cc5 = document.getElementsByClassName("c5-"+(ka+2));

						if(cc1[j]!=undefined){
							var cc1_parent = cc1[j].parentNode;
							cc1[j].setAttribute('style','width:0px');
						}
						if(cc2[j]!=undefined){
							var cc2_parent = cc2[j].parentNode;
							cc2[j].setAttribute('style','width:0px');
						}
						if(cc3[j]!=undefined){
							var cc3_parent = cc3[j].parentNode;
							cc3[j].setAttribute('style','width:0px');
						}
						if(cc4[j]!=undefined){
							var cc4_parent = cc4[j].parentNode;
							cc4[j].setAttribute('style','width:0px');
						}
					}


					if(note[i][0]!='-'){	//色と色の境の罫線、kbの計算

						var c1 = document.getElementsByClassName("c1-"+ka);
						c1[j].setAttribute('style','border-left:solid 2px');
						var c2 = document.getElementsByClassName("c2-"+ka);
						c2[j].setAttribute('style','border-left:solid 2px');
						var c3 = document.getElementsByClassName("c3-"+ka);
						c3[j].setAttribute('style','border-left:solid 2px');

						if(note[i][2]=='32'){
							kb=kb+(parseInt(minimum[1],10)/32);
						}
						if(note[i][2]=='32.'){
							kb=kb+((parseInt(minimum[1],10)/32)*1.5);
						}
						if(note[i][2]=='16'){
							kb=kb+(parseInt(minimum[1],10)/16);
						}
						if(note[i][2]=='16.'){
							kb=kb+((parseInt(minimum[1],10)/16)*1.5);
						}
						if(note[i][2]=='8'){
							kb=kb+(parseInt(minimum[1],10)/8);
						}
						if(note[i][2]=='8.'){
							kb=kb+((parseInt(minimum[1],10)/8)*1.5);
						}
						if(note[i][2]=='4'){
							kb=kb+(parseInt(minimum[1],10)/4);
						}
						if(note[i][2]=='4.'){
							kb=kb+((parseInt(minimum[1],10)/4)*1.5);
						}
						if(note[i][2]=='2'){
							kb=kb+(parseInt(minimum[1],10)/2);
						}
						if(note[i][2]=='2.'){
							kb=kb+((parseInt(minimum[1],10)/2)*1.5);
						}
						if(note[i][2]=='1'){
							kb=kb+parseInt(minimum[1],10);
						}

					}

					
					if(note[i][0]=='C4'){
						var c2 = document.getElementsByClassName("c2-"+ka); //ｃ１－〇をｃ１という配列に順番に入れる
						midinum[i]=60+key_num;					//指定された数字（キー）を加算する

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }//＃、♭を計算
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						//ｍｉｄｉナンバーを対応した音の色に返す関数
						color=HenkanColor(midinum[i],chou);//ｃｈｏｕは＃か♭かの選択
						HenkanOctave(midinum[i]); 			   //オクターブの印
					}

					if(note[i][0]=='D4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=62+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='E4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=64+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='F4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=65+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='G4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=67+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}
					
					if(note[i][0]=='A4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=69+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='B4'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=71+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='C3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=48+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='D3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=50+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='E3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=52+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}

					if(note[i][0]=='F3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=53+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]); 
					}
					if(note[i][0]=='G3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=55+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='A3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=57+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}
					if(note[i][0]=='B3'){
						var c2 = document.getElementsByClassName("c2-"+ka); 
						midinum[i]=59+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='C5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=72+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='D5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=74+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='E5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=76+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='F5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=77+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='G5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=79+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='A5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=81+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='B5'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=83+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='C2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=36+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='D2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=38+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='E2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=40+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='F2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=41+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='G2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=43+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='A2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=45+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='B2'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=47+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='C6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=84+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='D6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=86+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='E6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=88+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='F6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=89+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='G6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=91+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='A6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=93+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='B6'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=95+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='C7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=96+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='D7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=97+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}

					if(note[i][0]=='E7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=100+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}	

					if(note[i][0]=='F7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=101+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}	

					if(note[i][0]=='G7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=103+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}	

					if(note[i][0]=='A7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=105+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}	

					if(note[i][0]=='B7'){
						var c2 = document.getElementsByClassName("c2-"+ka); 	
						midinum[i]=107+key_num;					

						if(note[i][1]=='1'){ midinum[i]=midinum[i]+1; }
						if(note[i][1]=='-1'){ midinum[i]=midinum[i]-1; }

						color=HenkanColor(midinum[i],chou);
						HenkanOctave(midinum[i]);
					}


					//ｃｏｌｏｒに＋－がある　→　ｃ２［ｊ］に＋－をいれ、ｃｏｌｏｒに色のみいれる
					if(color.includes('+')){ 				//＋を含んでいたらｃ２［ｊ］に＋を表示
						c2[j].insertAdjacentHTML('afterbegin','<span style="font-weight:bold;">+</span>');
						color = color.replace('+', '');		//カラーコードのみにする
					}
					if(color.includes('－')){ 				//－を含んでいたらｃ２［ｊ］に－を表示
						c2[j].insertAdjacentHTML('afterbegin','<span style="font-weight:bold;">－</span>');
						color = color.replace('－', '');		//カラーコードのみにする
					}

						//＋－に白背景を付ける場合
						// c2[j].insertAdjacentHTML('afterbegin','<span style="background-color:#fff;font-weight:bold;">+</span>');
						// c2[j].insertAdjacentHTML('afterbegin','<span style="background-color:#fff;font-weight:bold;">－</span>');

					if(chou_ex==1){							//調号なしの場合調号を取り除く
						c2[j].innerHTML = c2[j].innerHTML.replace("+", "");
						c2[j].innerHTML = c2[j].innerHTML.replace("－", "");
					}

					for(var n=ka;n<kb;n++){					//色を表示
						var c2 = document.getElementsByClassName("c2-"+n);
						c2[j].setAttribute('bgcolor',color);
					}


					if(note[i][0]=='00'){			//休符の場合は灰色を表示
						for(var n=ka;n<kb;n++){
							var c2 = document.getElementsByClassName("c2-"+n);
							c2[j].setAttribute('bgcolor','#a9a9a9');
						}
					}

					if(note[i][0]=='0'){			//0の場合は白色を表示（タイ）
						for(var n=ka;n<kb;n++){
							var c2 = document.getElementsByClassName("c2-"+n);
							c2[j].setAttribute('bgcolor','#fff');
						}
					}




					if(note[i][3]!=null  && note[i][3]!=undefined){	//歌詞の挿入
						var c5 = document.getElementsByClassName("c5-"+ka);
						c5[j].innerHTML=note[i][3];
					}											

					if(note[i][0]!='-'){	//kaの計算
						if(note[i][2]=='32'){
							ka=ka+(parseInt(minimum[1],10)/32);
						}
						if(note[i][2]=='32.'){
                            var c2 = document.getElementsByClassName("c2-"+(ka));
							c2[j].insertAdjacentHTML('beforeend','<span style="font-weight:bold;">.</span>');
							ka=ka+((parseInt(minimum[1],10)/32)*1.5);
						}
						if(note[i][2]=='16'){
							ka=ka+(parseInt(minimum[1],10)/16);
						}
						if(note[i][2]=='16.'){
                            var c2 = document.getElementsByClassName("c2-"+(ka));
							c2[j].insertAdjacentHTML('beforeend','<span style="font-weight:bold;">.</span>');
							ka=ka+((parseInt(minimum[1],10)/16)*1.5);
						}
						if(note[i][2]=='8'){
							ka=ka+(parseInt(minimum[1],10)/8);
						}
						if(note[i][2]=='8.'){
                            var c2 = document.getElementsByClassName("c2-"+(ka));
							c2[j].insertAdjacentHTML('beforeend','<span style="font-weight:bold;">.</span>');
							ka=ka+((parseInt(minimum[1],10)/8)*1.5);
						}
						if(note[i][2]=='4'){
							ka=ka+(parseInt(minimum[1],10)/4);
						}
						if(note[i][2]=='4.'){
                            var c2 = document.getElementsByClassName("c2-"+(ka));
							c2[j].insertAdjacentHTML('beforeend','<span style="font-weight:bold;">.</span>');
							ka=ka+((parseInt(minimum[1],10)/4)*1.5);
						}
						if(note[i][2]=='2'){
							ka=ka+(parseInt(minimum[1],10)/2);
						}
						if(note[i][2]=='2.'){
                            var c2 = document.getElementsByClassName("c2-"+(ka));
							c2[j].insertAdjacentHTML('beforeend','<span style="font-weight:bold;">.</span>');
							ka=ka+((parseInt(minimum[1],10)/2)*1.5);
						}
						if(note[i][2]=='1'){
							ka=ka+parseInt(minimum[1],10);
						}
					}

					function HenkanOctave(n){
					//ｎはmidiナンバー
					var c1 = document.getElementsByClassName("c1-"+ka);	
					var c3 = document.getElementsByClassName("c3-"+ka);

						if(36<=n && n<=47){ //２オクターブ下
							c3[j].insertAdjacentHTML('beforeend','‥');
							return;
						}
						if(48<=n && n<=59){ //１オクターブ下
							c3[j].insertAdjacentHTML('beforeend','・');
							return;
						}

						if(72<=n && n<=83){ //１オクターブ上
							c1[j].insertAdjacentHTML('beforeend','・');
							return;
						}

						if(84<=n && n<=95){ //２オクターブ上
							c1[j].insertAdjacentHTML('beforeend','‥');
							return;
						}

						if(96<=n && n<=107){ //３オクターブ上
							c1[j].insertAdjacentHTML('beforeend','・・・');
							return;
						}
					}

					function HenkanColor(n,p){
						//ｐは調号の情報
						//ｎはナンバー						

						//C2-C7
						if(n==36 || n==48 || n==60 || n==72 || n==84 || n==96){
							return "#ff0000";
						}

						if(n==37 || n==49 || n==61 || n==73 || n==85 || n==97){
							if(p==1){
								return "#ff8000－";
							}
							return "#ff0000+";
						}

						if(n==38 || n==50 || n==62 || n==74 || n==86 || n==98){
							return "#ff8000";
						}

						if(n==39 || n==51 || n==63 || n==75 || n==87 || n==99){
							if(p==1){
								return "#fff000－";
							}
							return "#ff8000+";
						}

						if(n==40 || n==52 || n==64 || n==76 || n==88 || n==100){
							return "#fff000";
						}

						if(n==41 || n==53 || n==65 || n==77 || n==89 || n==101){
							return "#00c000";
						}

						if(n==42 || n==54 || n==66 || n==78 || n==90 || n==102){
							if(p==1){
								return "#00ffff－";
							}
							return "#00c000+";
						}

						if(n==43 || n==55 || n==67 || n==79 || n==91 || n==103){
							return "#00ffff";
						}

						if(n==44 || n==56 || n==68 || n==80 || n==92 || n==104){
							if(p==1){
								return "#0000ff－"
							}
							return "#00ffff+";
						}


						if(n==45 || n==57 || n==69 || n==81 || n==93 || n==105){
							return "#0000ff";
						}

						if(n==46 || n==58 || n==70 || n==82 || n==94 || n==106){
							if(p==1){
								return "#c000c0－";
							}
							return "#0000ff+";
						}

						if(n==47 || n==59 || n==71 || n==83 || n==95 || n==107){
							return "#c000c0";
						}


					}

				}

			})

		})

		function WindowOpen(){			//「新しいウィンドウで開く」ボタンの関数
			var scorebox = document.getElementById("box1");	
			var nwin = window.open("","_blank");

			window.location.reload();	//親ページを更新

			nwin.document.open();			
			nwin.document.write('<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>楽譜表示</title><link rel="stylesheet" href="gakuhu_color.css" type="text/css"></head><body></body></html>');
			nwin.document.body.appendChild(textbox);
			nwin.document.body.appendChild(scorebox);
			nwin.document.body.appendChild(titlebox);
			nwin.document.body.appendChild(composerbox);
			nwin.document.body.appendChild(lyricistbox);
			nwin.document.body.appendChild(copyrightbox);
			nwin.document.body.appendChild(tempobox);

		}


	</script>
</body>
</html>
